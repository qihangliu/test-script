# =================================================================
# 基础镜像：使用 Maven 官方镜像
# =================================================================
# 使用一个包含 JDK 21 和 Maven 3 的稳定镜像
FROM maven:3.9.11-eclipse-temurin-21

# =================================================================
# 环境准备与软件安装
# 切换到 root 用户以安装必要的工具
# =================================================================
USER root

# 在单个 RUN 指令中更新、安装并清理，以减小镜像层的大小。
# - sed:  将 apt 源更换为阿里云镜像，加速国内下载。
# - curl: 用于在 Jenkins Pipeline 中调用 API。
# - jq:   用于在 Jenkins Pipeline 中解析 API 返回的 JSON 数据。
RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list && \
    apt-get update && \
    apt-get install -y --no-install-recommends \
        curl \
        jq && \
    # 清理 apt 缓存，减小镜像体积
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# =================================================================
# 切换回默认的非 root 用户
# 这是安全最佳实践，避免以 root 权限运行构建
# =================================================================
USER maven
